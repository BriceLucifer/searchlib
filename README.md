# searchlib文档

## 概述

本工具旨在提供一种管理和处理目录与文件的方式，重点是搜索和组织功能。该应用使用 Rust 编程语言开发，并利用多个外部 crates 增强其功能，包括数据库交互、文本处理和命令行解析。工具版本为 `v1`。

## 安装

在使用此工具之前，请确保您的系统中已安装 Rust 和 Cargo。

安装教程官方网站：

```web-idl
https://www.rust-lang.org/zh-CN/tools/install
```

## 功能介绍

该工具提供了以下主要功能：

- **init [Path] (初始化目标目录)**：

  - **目录初始化**

  - **目的**：扫描用户指定的目录及其所有子目录，将文件和目录信息存入本地数据库，为后续的搜索操作建立基础。
  - **实现细节**：使用 `walkdir` crate 遍历目录，`rusqlite` crate 管理 SQLite 数据库进行数据存储。

- **search [pattern] (正则表达式搜索)**：

  - **文件搜索**

  - **正则表达式搜索**：允许用户使用正则表达式匹配文件名，适用于精确搜索场景。

- **delaynomore [filename] (基于内容相似度的搜索)**：

  - 使用 `finalfusion` crate 加载预训练的词嵌入模型，计算文件名之间的语义相似度，返回最相关的文件

## 使用说明

### 命令行界面

工具提供了简洁的命令行界面，使用 `clap` crate 实现命令行参数的解析。用户可以通过命令行参数执行不同的操作，如初始化目录、执行搜索等。

### 命令行参数

- `init`：初始化目标目录，扫描并记录其内容。
- `search`：使用正则表达式进行文件搜索。
- `delaynomore`：进行基于内容相似度的搜索。
- 示例操作
  - 初始化目录：`cargo run -- init "/path/to/directory"`
  - 正则表达式搜索：`cargo run -- search "^example.*\.txt$"`
  - 基于内容相似度的搜索：`cargo run -- delaynomore "example.txt"`

### 示例

1. **初始化目录**

   ```
   cargo run -- init /path/to/directory
   ```

   这将扫描指定的目录，并将找到的文件信息存储在本地数据库中。

2. **正则表达式搜索**

   ```
   cargo run -- search "pattern"
   ```

   使用正则表达式 `"pattern"` 来搜索之前初始化的目录中的文件。

3. **基于内容相似度的搜索**

   ```
   cargo run -- delaynomore "filename"
   ```

   搜索与 `"filename"` 语义上最相似的文件名。

## 技术细节

### 数据存储

- 使用 SQLite 数据库存储文件信息，包括文件名、路径、类型和大小等。
- 通过 Rust 的 `rusqlite` crate 进行数据库操作，保证数据的持久化和高效访问。

### 正则表达式处理

- 利用 `regex` crate 处理正则表达式，提供灵活的文本匹配功能。

### 语义相似度计算

- 使用 `finalfusion` crate 加载预训练的词向量模型，通过计算文件名的词向量之间的余弦相似度，实现基于内容的相似度搜索。

### 性能优化技巧

- 对 SQLite 数据库进行优化设置，如调整缓存大小、关闭日志模式等，以提高读写性能。
- 在处理大量文件时，合理管理内存使用，避免不必要的内存分配和泄漏。

## 构建与运行

1. 克隆仓库到本地。
2. 在项目根目录下运行 `cargo build` 构建项目。
3. 使用 `cargo run -- [COMMAND]` 运行工具，其中 `[COMMAND]` 是上述命令之一。

## 注意事项

- 在使用 `delaynomore` 命令之前，确保已经初始化了目标目录。
- 该工具的性能可能受到处理的目录大小和文件数量的影响。

## 结论

本文档提供了该目录和文件处理工具的详细介绍，包括其功能特性、使用方法和技术实现细节。通过使用本工具，用户可以有效地管理本地文件系统中的文件，进行快速搜索和组织。希望本文档能帮助用户更好地理解和使用这一工具，提高文件管理和搜索的效率。